---
title: 「MySQL学习笔记03」关系数据库标准语言SQL
author: JoyDee
categories: [DataBase, MySQL]
tags: [MySQL]
date: 2021-01-28 13:46:00 +0800
math: true
---

## 3.1 SQL概述

结构化查询语言（Structured Query Language, SQL）是关系数据库的标准语言，其功能不仅仅是查询，而是包括数据库模式创建、数据库数据的插入与修改、数据库安全性完整性定义与控制等一系列功能。

有一些计算可用通用的程序设计语言来表达，但无法通过SQL来表达；SQL还不支持诸如从用户那输入、输出到显示器，或者通过网络通信这样的动作。这样的计算和动作必须用一种**宿主语言**来写，比如C、C++或Java，在其中使用嵌入式的SQL查询来访问数据库中的数据。

### 3.1.1 SQL语句分类

1. DDL（Data Definition Language，数据定义语言）用来**定义**数据库对象：数据库，表，列等。关键字：`CREATE`，`DROP` ，`ALTER` 等
2. **DML**（Data Manipulation Language，数据操纵语言）用来对数据库中**表的数据**进行**增删改**。关键字：`INSERT`，`DELETE`，`UPDATE` 等
3. **DQL**（Data Query Language，数据查询语言）用来**查询**数据库中**表的记录**。关键字：`SELECT`，`WHERE` 等
4. DCL（Data Control Language，数据控制语言）用来定义数据库的访问权限和安全级别，及创建用户。关键字：`GRANT`，`REVOKE`等

> 目前，没有一个数据库系统能够支持SQL标准的所有概念和特性。各个关系数据库管理系统产品在实现标准SQL时各有差别，本文主要围绕MySQL相关的语句。

### 3.1.2 SQL通用语法

1. SQL语句以**分号**结尾，故可单行或多行书写，并使用空格和缩进来增强语句可读性；

2. MySQL数据库的SQL语句不区分大小写，关键字建议使用大写。

3. 几种注释：

   + 单行注释：`-- 注释内容` 或 `# 注释内容`（MySQL特有）

   + 多行注释：`/* 注释内容 */`



## 3.2 DDL：操作数据库、表

### 3.2.1 操作数据库

一、C（Create）：创建数据库

+ 创建数据库：

  ```sql
  CREATE DATABASE 数据库名称;
  ```

+ 判断某个数据库是否存在，若不存在则创建该数据库：

  ```sql	
  CREATE DATABASE IF NOT EXISTS 数据库名称; /* 注意's' */
  ```

+ 创建数据库的同时指定字符集：

  ```sql
  CREATE DATABASE 数据库名称 CHARACTER SET 字符集名称;
  ```

  综合使用：

  ```sql
  CREATE DATABASE IF NOT EXISTS db_1 CHARACTER SET utf8;
  ```

二、R（Retrieve）：查询数据库

+ 查询所有数据库的名称

  ```sql
  SHOW DATABASES; /* 注意databases是复数形式的! */
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210128160958.png" style="zoom:67%;" />

+ 查询某个数据库的字符集：查询某个数据库的创建语句

  ```sql
  SHOW CREATE DATABASE 数据库名称;
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210128161133.png"/>

三、U（Update）：修改

+ 修改数据库的字符集

  ```sql
  ALTER DATABASE 数据库名称 CHARACTER SET 字符集名称;
  ```

四、D（Delete）：删除

+ 删除数据库

  ```sql
  DROP DATABASE 数据库名称;
  ```

+ 判断数据库存在，存在再删除

  ```sql
  DROP DATABASE IF EXISTS 数据库名称;
  ```

五、使用数据库

+ 查询当前正在使用的数据库名称

  ```sql
  SELECT DATABASE();
  ```

+ **使用数据库**

  ```sql
  USE 数据库名称;
  ```



### 3.2.2 MySQL数据类型

一、数值类型

| 类型             | 大小( bytes)                             | 范围（有符号下）                                    | 用途            |
| :--------------- | :--------------------------------------- | :-------------------------------------------------- | :-------------- |
| TINYINT          | 1 byte                                   | $(-128，+127)$                                      | 小整数值        |
| SMALLINT         | 2 bytes                                  | $(-32 768，+32 767)$                                | 大整数值        |
| MEDIUMINT        | 3 bytes                                  | $(-8.3E+6，+8.3E+6 )$                               | 大整数值        |
| **INT**或INTEGER | 4 bytes                                  | $(-2E+9，+2E+9)$                                    | 大整数值        |
| BIGINT           | 8 bytes                                  | $(-9E+18，+9E+18)$                                  | 极大整数值      |
| **FLOAT**        | 4 bytes                                  | $(-3E+38，-1.2E-38)，0，(+1.2E-38，+3.4E+38)$       | 单精度 浮点数值 |
| **DOUBLE**       | 8 bytes                                  | $(-1.8E+308，-2.2E-308)，0，(+2.2E-308，+1.8E+308)$ | 双精度 浮点数值 |
| DECIMAL          | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 依赖于M和D的值                                      | 小数值          |

> 若在`float(7, 4)`列插入 999.00009，则存进的结果为 999.0001（总共7位，保留4位小数）

二、日期和时间类型

|   类型    | 大小 ( bytes) |        格式         |                             用途                             |
| :-------: | :-----------: | :-----------------: | :----------------------------------------------------------: |
| **DATE**  |       3       |     YYYY-MM-DD      |                            日期值                            |
|   TIME    |       3       |      HH:MM:SS       |                       时间值或持续时间                       |
|   YEAR    |       1       |        YYYY         |                            年份值                            |
| DATETIME  |       8       | YYYY-MM-DD HH:MM:SS |                       混合日期和时间值                       |
| TIMESTAMP |       4       | YYYY-MM-DD HH:MM:SS | 混合日期和时间值，时间戳，若不给这个字段赋值，则会使用当前的系统时间 |

> MySQL不会给`TIMESTAMP`设置默认值，除非显式设置`DEFAULT`约束，比如默认值可设为 `NOW()`  或 `CURRENT_TIMESTAMP()`，又或者显示设置可空 `NULL`。

> ❗︎ 除了数值类型，其他类型一定一定要记得用引号引起来。

三、字符串类型

> 对于MySQL 5.0 以上的版本，一个汉字占多少长度与编码有关：
>
> + UTF-8：一个汉字占3个字节；
> + GBK：一个汉字占2个字节；

|    类型     |      大小      |                             用途                             |
| :---------: | :------------: | :----------------------------------------------------------: |
|    CHAR     |  0-255 bytes   | 定长字符串，若实际长度不够会用空格填充，但查询时返回的数据尾部无空格 |
| **VARCHAR** | 0-65535 bytes  | 变长字符串，而 `VARCHAR(n)` 表示的是 `n` 个**字符**（无论汉字、英文），只是实际字节长度有所区别 |
|  TINYBLOB   |  0-255 bytes   |               不超过 255 个字符的二进制字符串                |
|  TINYTEXT   |  0-255 bytes   |                         短文本字符串                         |
|    BLOB     | 0-65 535 bytes |                    二进制形式的长文本数据                    |
|    TEXT     | 0-65 535 bytes |                          长文本数据                          |
|      …      |                |                                                              |



### 3.2.3 操作表：CRUD

一、C（Create）：创建表

+ 直接创建

  ```sql
  CREATE TABLE 表名(
  	列名1 数据类型1,
      列名2 数据类型2,
      ...
  );
  ```

  举例使用：

  ```sql
  CREATE TABLE `timestampTest` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `name` varchar(20) DEFAULT NULL,
    `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, /* 创建时间 */
    `last_modify_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, /* 最后更新时间 */
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
  ```
  
+ 复制表：

  ```sql
  CREATE TABLE 表名 like 被复制的表名;
  ```

二、R（Retrieve）：查询表

+ 查询某个数据库中所有表的名称

  ```sql
  SHOW TABLES; /* 注意tables是复数形式*/
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210128212951.png" style="zoom:80%;" />

+ 查询表的结构（查看属性名 即列名）

  ```sql
  DESC 表名;
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210128213326.png" style="zoom:80%;" />

三、U（Update）：修改表

+ 修改表名

  ```sql
  ALTER TABLE 表名 RENAME TO 新的表名;
  ```

+ 修改表的字符集

  ```sql
  ALTER TABLE 表名 CHARACTER SET 字符集名称;
  ```

+ 添加一列

  ```sql
  ALTER TABLE 表名 ADD 列名 数据类型;
  ```

+ 修改列名称、类型

  ```sql
  ALTER TABLE 表名 CHANGE 原列名 新列名 新数据类型;
  ALTER TABLE 表名 MODIFY 列名 新数据类型;
  ```

+ 删除列

  ```sql
  ALTER TABLE 表名 DROP 列名;
  ```

四、D（Delete）：删除表

+ 直接删除

  ```sql
  DROP TABLE 表名;
  ```

+ 判断该表存在，存在再删除

  ```sql
  DROP TABLE IF EXISTS 表名;
  ```



## 3.3 DML：增删改表中的数据

一、添加数据

```sql
INSERT INTO 表名(列名1, 列名2, ...) VALUES(值1, 值2, ...);
```

> 注意：
>
> 1. 列名要与值一一对应，若表名后不加列名，则默认给所有值添加值。
> 2. 除数字类型，其他类型需使用（单/双）引号引起来。
> 3. 插入的数据大小应在列的规定范围内（如，不能将长度为80的字符串加入到长度为40的列）

[ 附 ]：复制数据

从 表1中的特定列的数据 复制到 表2中的特定列 中 。

```sql
INSERT INTO 表名2(列名1, 列名2) SELECT 列名1, 列名 FROM 表名1;
```

举例使用：

| 表 `STU2` 初始时记录信息                                     | 表 `STU3` 初始时记录信息                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210129200607.png" style="zoom:80%;" /> | <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210129200634.png" style="zoom:80%;" /> |

执行下列语句后：

```sql
INSERT INTO STU2(name) SELECT house FROM STU3; 
/* 也就说将表STU3的house列的所有数据，插入到表STU2的name列后面 */
```

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210129200829.png" style="zoom:80%;" />

三、删除数据

```sql
DELETE FROM 表名 WHERE 条件;
```

> 注意：
>
> 1. 若不加条件，则会删除表中所有记录。
>
> 2. 若要删除所有记录，
>
>    ```sql
>    DELETE FROM 表名; /* 不推荐使用 */
>    TRUNCATE TABLE 表名; /* 推荐使用，它实际上是先删除表，然后再创建一个同名的表 */
>    ```

四、修改数据

```sql
UPDATE 表名 SET 列名1 = 值1, 列名2 = 值2, .... WHERE 条件; /* 若不加条件，则会将表中所有记录全部修改 */
```

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210129161921.png" style="zoom:75%;" />



## 3.4 DQL：查询表中的记录

### 3.4.1 基础查询

+ 查询表中**所有**行和列的**数据**（使用 `*` 表示所有列）

  ```sql
  SELECT * FROM 表名;
  ```

+ 查询指定列

  ```sql
  SELECT 列名1, 列名2, ... FROM 表名;
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210129202622.png" style="zoom:80%;" />

+ 查询指定列并起别名

  ```sql
  SELECT 原列名1 AS 别名1, 原列名2 AS 别名2, ... FROM 表名;
  
  SELECT 原列名1 AS 别名1, 原列名2 AS 别名2, ... FROM 表名 AS 表的别名; /* 查询后得到的表 也起别名，常用于多表查询操作中 */
  ```

+ 查询指定列且结果不出现重复数据

  ```sql
  SELECT DISTINCT 列名 FROM 表名;
  ```

+ 查询的结果参与**数值**运算

  ```sql
  SELECT 列名1 + 固定值 FROM 表名;
  
  SELECT 列名1 + 列名2 FROM 表名;
  ```

  > 某列数据与 `NULL` 运算后得到的结果仍为 `NULL` 。
  >
  > 假如总分是数学与英语的总和，而张三考了数学，但缺考英语，此时的结果应该是数学成绩+0，为了避免出现 `NULL`，可以用 `IFNULL`  来处理。

  `IFNULL(表达式1, 表达式2)` ——如果表达式1的值为`NULL`，则 结果 会替换成表达式2的值。

  ```sql
  SELECT IFNULL(MATH, 0) + IFNULL(ENGLISH, 0) AS SCORE FROM STU;
  ```



### 3.4.2 条件查询

条件语句的语法：

```sql
SELECT 列名 FROM 表名 WHERE 条件;
```

以下为运算符列表，可用于 WHERE 子句中，从而有条件地从表中查询数据。

|                运算符                |                          说明                          |
| :----------------------------------: | :----------------------------------------------------: |
| `>`、`<`、`<=`、`>=`、**`=`** 、`<>` | `<>` 在SQL中表示“不等于”，注意MySQL中没有`==`，只有`=` |
|           `AND` 或者 `&&`            |                建议使用前者，后者不通用                |
|            `OR` 或者 `||`            |                建议使用前者，后者不通用                |
|            `NOT` 或者 `!`            |                建议使用前者，后者不通用                |
|                 `IN`                 |         常用与`IN( 集合 )`，集合中使用逗号分隔         |
|              `IS NULL`               |      查询某一列是否`NULL`，注意，不能写成`=NULL`       |

```sql
/* 查询年龄不等于20岁 */
SELECT * FROM stu WHERE age != 20;
SELECT * FROM stu WHERE age <> 20;

/* 查询年龄在[20, 30]岁 */
SELECT * FROM stu WHERE age >= 20 AND age <= 30;
SELECT * FROM stu WHERE age BETWEEN 20 AND 30;

/* 查询年龄为22岁、18岁、25岁 */
SELECT * FROM stu WHERE age = 22 OR age = 18 OR age = 25;
SELECT * FROM stu WHERE age IN (22, 18, 25);

/* 查询英语成绩不为NULL */
SELECT * FROM stu WHERE English IS NOT NULL;
```

⭐模糊查询：

```sql
SELECT * FROM 表名 WHERE 列名 LIKE '通配符字符串';
```

MySQL下的通配符：

+ `%`：匹配任意多个字符
+ `_`：匹配仅一个字符

```sql
/* 查询姓"王"的人 */
SELECT * FROM stu WHERE name LIKE '王%';

/* 查询姓名中第二个字为路的人 */
SELECT * FROM stu WHERE name LIKE '_路%';

/* 查询姓名中含有"飞"的人 */
SELECT * FROM stu WHERE name LIKE '%飞%';

/* 查询姓名是3个字的人 */
SELECT * FROM stu WHERE name LIKE '___';
```



### 3.4.3 排序查询

通过 `ORDER BY` 子句，可将查询出的结果进行排序。

> 此处的排序仅是显示方式，并不会影响数据库中原有的数据排列顺序。

```sql
SELECT 列名 FROM 表名 ORDER BY 列名1 [ASC|DESC], 列名2 [ASC|DESC], ...
```

+ `ASC`：默认值，升序；
+ `DESC`：降序

```sql
SELECT * FROM stu ORDER BY math DESC;

/* 先对数学成绩升序排序，若数学成绩相同则再对英语成绩升序排序 */
SELECT * FROM stu ORDER BY math ASC, english ASC;
```



### 3.4.4 聚合函数

以上的查询均是横向查询，即根据条件一行一行地进行判断。而接下来的聚合函数查询是纵向查询，即对**一列**的值进行计算，最后返回**一个**返回值。

```sql
SELECT 聚合函数(列名) FROM 表名
```

> 注意，聚合函数会忽略`NULL`，若要考进`NULL`，则建议列名使用**主键**，见下。

|      SQL中的聚合函数       |            作用             |
| :------------------------: | :-------------------------: |
| `MAX(列名)` 或 `MIN(列名)` | 求这一列中的最大值 或最小值 |
|        `SUM(列名)`         |    对这一列的值进行求和     |
|        `AVG(列名)`         |      求这一列的平均值       |
|       `COUNT(列名)`        |   统计这一列有多少条记录    |

```sql
SELECT COUNT(id) AS 总人数 FROM stu;
SELECT COUNT(*) AS 总人数 FROM stu; 
SELECT COUNT(IFNULL(id, 0)) FROM stu;
/* 上面三句是等价的，建议使用第一条 */

SELECT COUNT(id) FROM stu WHERE age>18; 
```



### 3.4.5 分组查询

分组查询，使用`GROUP by` 语句对信息进行分组，相同数据作为一组，再进行查询。一般分组查询会与聚合函数一同使用。

```sql
SELECT 列名1, 列名2, ... FROM 表名 GROUP BY 分组的列名 [HAVING 条件];
```

+ 举例使用：

  ```sql
  SELECT sex, AVG(math) FROM stu GROUP BY sex;
  ```

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210130020555.png" style="zoom:67%;" />

**`HAVING`子句与 `WHERE` 子句的区别**

|     子名      |                            特点①                             | 特点②                        |
| :-----------: | :----------------------------------------------------------: | ---------------------------- |
| `WHERE 子句`  | 对查询结果进行分组前，先将不符合`WHERE`条件的行去掉，即先过滤再分组。 | `WHERE`后面不能使用聚合函数  |
| `HAVING 子句` |                         先分组再过滤                         | `HAVING`后面可以使用聚合函数 |

```sql
/* 先按性别分组，分别查询男、女同学的平均分，其中分数不大于70的人不参与统计，分组后，人数大于2的组才能显示出来 */
SELECT sex, AVG(math), COUNT(id) FROM stu WHERE math > 70 GROUP BY sex HAVING COUNT(id) > 2;
```



### 3.4.6 分页查询

`LIMIT`子句属于MySQL中的“方言”，它限制查询记录的条数。

```sql
SELECT 列名 FROM 表名 LIMIT 起始索引, 每页查询的页数;
```

起始索引 = （当前的页面 $- 1$）$\times$ 每页查询的页数

> 起始索引从0计数，省略不写即是从0计数。

```sql
SELECT * FROM dbx LIMIT 0, 3; /* 第一页 */
SELECT * FROM dbx LIMIT 3, 3; /* 第二页 */
SELECT * FROM dbx LIMIT 6, 3; /* 最末页 */
```

|                            第一页                            |                            第二页                            |                            最末页                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210130023419.png" style="zoom:67%;" /> | <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210130023442.png" style="zoom:67%;" /> | <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210130023500.png" style="zoom:67%;" /> |

